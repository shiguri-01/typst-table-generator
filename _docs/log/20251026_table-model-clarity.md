# Table model clarification pass

- Date: 2025-10-26

## Purpose
Spec で抜けている挙動や前提を補い、実装時に迷わないよう TableModel とスタイルプリセットの定義を明確化する。

## Plan / TODO
- [x] 現行仕様を読み返し、あいまいなフィールドや未定義の前提を洗い出す
- [x] `_docs/spec.md` の TableModel 節にフィールドごとの意味とデフォルトを追記する
- [x] スタイルプリセットの辞書構造と Typst 出力への反映手順を明文化する

## Notes (随時追記)
- 設計・検討メモ:
  - `ColumnSpec.width` は pt 単位で扱い、将来拡張時に `Length` 表現を導入する余地を残す。
  - `headerRows` の既定値や上限処理を明文化する必要がある → クランプ仕様を追加。
  - `body.hlines` のインデックス規約(`-1`)は補足説明が必須 → 変換手順に明記。
- 気づき/意思決定:
  - 既存の UI は列数を固定長に正規化する前提なので、`rows` を矩形配列とする制約を明示する。
  - `ColumnSpec.width` の数値は pt として扱い、Typst 出力の `columns:` へそのまま埋め込む。
- 困りごと/対応:
  - なし。


## Summary
- TableModel の各フィールドについてデフォルト値、クランプ、整列フォールバックなど実装で必要な判断基準を追加した。
- 読み込み/書き込み時の正規化手順を明文化し、矩形配列と列設定の同期方法を定義した。
- スタイルプリセットの辞書構造と `body.hlines` のインデックス規約、Typst 変換時の扱いを追記した。

## Next (必要に応じて)
- （必要なら追記）

## Reflection (感想)
一度シンプルにした仕様でも、利用者視点で迷いそうな前提は細かく残るので、値域やフォールバックを文章化しておくと安心感が増す。

## Pre-PR Checklist
- [x] `_docs/spec.md` 更新（該当章 + 「Specの変更点」メモ）（必要に応じて）
- [ ] `bun run check` を通過
- [ ] `bun run test` を通過（必要なテストを追加）
- [ ] `bun run build`（ビルド/ランタイムに影響がある場合）
